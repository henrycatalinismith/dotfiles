set nocompatible

" Turn off the annoying beep
autocmd! GUIEnter * set vb t_vb=

" Turn on Vim's built-in file type detection magic
filetype plugin indent on

" Hide the ~ characters in an empty buffer
highlight! EndOfBuffer guifg=bg

" SignColumn & LineNr => same colour
highlight! link SignColumn LineNr

" Learned these Alt+Up & Alt+Down shortcuts to move lines around from VS Code
" and can't live without them any more!
inoremap <M-Down> <Esc>:m +1<CR>
inoremap <M-Up> <Esc>:m -2<CR>

" Space is the best leader key
map <Space> <Leader>

" Ex mode: no thanks
map Q <nop>

" Make Y work like C and D
map Y y$

" Ctrl + Tab to go forward a tab
nnoremap <C-Tab> :tabnext<CR>

" Ctrl + Shift + Tab to go back a tab
nnoremap <C-S-Tab> :tabprevious<CR>

" <Space> , to open config
nnoremap <leader>, :call OpenConfig()<CR>

" <Space> m to open :messages in a split pane
nnoremap <leader>m :call ShowMessages()<CR>

" <Space> q for quick exit
nnoremap <leader>q :quit!<CR>

" <Space> t to open a new terminal
nnoremap <leader>t :call OpenTerminal()<CR>

" <Space> w for quicksave
nnoremap <leader>w :write<CR>

" Dark mode
set bg=dark

" Make vsplit markers flat
" set fillchars=""
set fillchars=eob:\ 

" https://typeof.net/Iosevka/
set guifont=Iosevka:h18

" No fancy GUI tabs
set guioptions-=e

" Case insensitive search
set ignorecase

" Incremental search
set incsearch

" Always show statusbar
set laststatus=2

" No beeping
set noerrorbells

" Swap files are annoying
set noswapfile

" Flashing is annoying
set novisualbell

" Line numbers
set number

" 2 means always, even when only one tab is open
set showtabline=2

" Yes means always, even when empty, avoiding a layout shift if enabling later
set signcolumn=yes

" Smartindent is pretty good
set smartindent

" https://www.nerdbude.com/vim_statusline.html
set statusline=
set statusline+=\ %#NormalC#%{(mode()=='n')?'\ NORMAL\ ':''}
set statusline+=%#InsertC#%{(mode()=='i')?'\ INSERT\ ':''}
set statusline+=%#VisualC#%{(mode()=='v')?'\ VISUAL\ ':''}
set statusline+=%#Filename#
set statusline+=\ %f
set statusline+=%#ReadOnly#
set statusline+=\ %r
set statusline+=%m
set statusline+=%=
set statusline+=%#Fileformat#
set statusline+=\ %y
set statusline+=\ %{&fileencoding?&fileencoding:&encoding}
set statusline+=\ [%{&fileformat}\]
set statusline+=%#Position#
set statusline+=\ [%l/%L]

syntax off

function! OpenTerminal()
  let commands = ["terminal ++curwin"]
  let is_empty_buffer = bufname("%") ==# "" && line("$") == 1 && getline(1) == ""
  " When opening from an empty buffer we skip the tabnew step and just convert
  " the current buffer directly to a terminal.
  if !is_empty_buffer
    call insert(commands, "tabnew", 0)
  endif
  execute join(commands, " | ")
endfunction

" chartreuse 7fff00
" darkslategray 2f4f4f
" greenyellow adff2f
" green 008000
" lawngreen 7cfc00
" lightgreen 90ee90
" lime 00ff00
" limegreen 32cd32
" mediumseagreen 3cb371
" olive 808000
" olivedrab 6b8e23
" yellowgreen 9acd32

hi NormalC guifg=#7cfc00 guibg=#1a1a1a
hi InsertC guifg=#7cfc00 guibg=#1a1a1a
hi VisualC guifg=#7cfc00 guibg=#1a1a1a
hi Filename guifg=#adff2f guibg=#1a1a1a

hi Normal guifg=#7fff00 guibg=#000000
hi Question guifg=#7fff00
hi clear Title
hi Title guifg=#7fff00
hi StatusLine guibg=#1a1a1a guifg=#008000
hi StatusLineTerm guibg=#1a1a1a guifg=#008000
hi LineNr guibg=#000000 guifg=#008000
hi TabLineFill guifg=#1a1a1a
hi TabLine guibg=#1a1a1a guifg=#008000
hi Cursor guifg=#000000 guibg=#7fff00
hi iCursor guifg=#000000 guibg=#00ff0
hi SignColumn guibg=#000000
hi Visual guibg=#004400 guifg=NONE
hi Pmenu guibg=#1a1a1a guifg=#7fff00
hi PmenuSel guibg=#3cb371 guifg=#000000
hi MatchParen guibg=#006400 guifg=#adff2f gui=bold

" Set up next/prev tab shortcuts in terminal mode
tnoremap <C-S-Tab> <C-\><C-N>:tabprevious<CR>
tnoremap <C-Tab> <C-\><C-N>:tabnext<CR>

" Hit escape twice to enter normal mode in the terminal.
" It's twice instead of the usual once because some terminal programs listen
" for escape keypresses and we don't want to mess with that.
tnoremap <Esc><Esc> <C-\><C-N>

function! ShowMessages()
  redir => messages_output
  silent messages
  redir END
  belowright new
  setlocal buftype=nofile bufhidden=wipe noswapfile nobuflisted
  call setline(1, split(messages_output, "\n"))
endfunction

function! OpenConfig()
  let is_empty = bufname("%") ==# "" && line("$") == 1 && getline(1) == ""
  if is_empty
    execute "edit" fnameescape(expand("~/.gvimrc"))
  else
    execute "tabedit" fnameescape(expand("~/.gvimrc"))
  endif
endfunction

set path+=**
set wildmenu

